---
- name: Start the Docker containers
  hosts: localhost
  gather_facts: false

  vars_files:
    - docker_containers.yml

  vars:
    - container_state: started
    - container_privileged: true

  roles:
    - docker

  tags:
    - docker-start


- name: Test the Package role for CentOS and Ubuntu systems
  hosts: package
  become: yes
  become_method: sudo

  vars:
    - package:
      - name: ansible

  roles:
    - ansible-role-package
    - package-test

  tags:
    - package

- name: Test the Package role for CentOS
  hosts: package-centos
  become: yes
  become_method: sudo

  vars:
    - pre_package:
        - name: epel-release
        - name: centos-release-openstack-rocky
    - package:
        - name: mariadb-5.5.60
    - yum_repository:
        - name: jenkins
          description: Jenkins
          baseurl: http://pkg.jenkins.io/redhat
          gpgkey: https://jenkins-ci.org/redhat/jenkins-ci.org.key
          gpgcheck: 1
    - yum_versionlock:
        - name: mariadb
          version: 5.5.60

  roles:
    - ansible-role-package
    - package-centos-test

  tags:
    - package-centos


- name: Stop the Docker containers
  hosts: localhost
  gather_facts: false

  vars_files:
    - docker_containers.yml

  vars:
    - container_state: absent

  roles:
    - docker

  tags:
    - docker-stop
