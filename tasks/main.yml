---
- name: Install apt repositories
  apt_repository:
    repo: "{{ item.repo }}"
    state: "{{ item.state | default(apt_repository_state) }}"
  with_items: "{{ apt_repository }}"
  when: ansible_os_family == "Debian"

- name: Install yum repositories
  yum_repository:
    name: "{{ item.name }}"
    state: "{{ item.state | default(yum_repository_state) }}"
    baseurl: "{{ item.baseurl }}"
    description: "{{ item.description }}"
    exclude: "{{ item.exclude | default(omit) }}"
    gpgcakey: "{{ item.gpgcakey | default(omit) }}"
    gpgcheck: "{{ item.gpgcheck | default(omit) }}"
    gpgkey: "{{ item.gpgkey | default(omit) }}"
    mirrorlist: "{{ item.mirrorlist | default(omit) }}"
  with_items: "{{ yum_repository }}"
  when: ansible_os_family == "RedHat"

- name: Install pre-packages
  package:
    name: "{{ item.name }}"
    state: "{{ item.state | default(pre_package_state) }}"
  with_items: "{{ pre_package }}"

- name: Install packages
  package:
    name: "{{ item.name }}"
    state: "{{ item.state | default(package_state) }}"
  with_items: "{{ package }}"

- name: Install post-packages
  package:
    name: "{{ item.name }}"
    state: "{{ item.state | default(post_package_state) }}"
  with_items: "{{ post_package }}"
